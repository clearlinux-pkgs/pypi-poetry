From 1215ba8f339a03701d4f87105c3bb4c54f34b7b0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Randy=20D=C3=B6ring?=
 <30527984+radoering@users.noreply.github.com>
Date: Wed, 5 Oct 2022 23:17:28 +0200
Subject: [PATCH] chore: update poetry-core to 1.3 and fix deprecations

---
 poetry.lock                                   |  18 +++++++-----------
 pyproject.toml                                |   4 +---
 src/poetry/console/commands/add.py            |   2 +-
 src/poetry/console/commands/self/add.py       |   2 +-
 src/poetry/console/commands/show.py           |   2 +-
 src/poetry/console/commands/version.py        |   4 ++--
 src/poetry/installation/chooser.py            |   2 +-
 src/poetry/installation/pip_installer.py      |   2 +-
 src/poetry/masonry/builders/editable.py       |   2 +-
 src/poetry/mixology/failure.py                |   2 +-
 .../solutions/python_requirement_solution.py  |   2 +-
 src/poetry/mixology/term.py                   |   2 +-
 src/poetry/packages/locker.py                 |   4 ++--
 src/poetry/publishing/uploader.py             |   8 +++++---
 src/poetry/puzzle/provider.py                 |   6 +++---
 src/poetry/repositories/cached.py             |   4 ++--
 src/poetry/repositories/http.py               |   2 +-
 src/poetry/repositories/legacy_repository.py  |   4 ++--
 src/poetry/repositories/link_sources/base.py  |   2 +-
 src/poetry/repositories/pool.py               |   2 +-
 src/poetry/repositories/pypi_repository.py    |   4 ++--
 src/poetry/repositories/repository.py         |   6 +++---
 src/poetry/utils/env.py                       |   4 ++--
 src/poetry/utils/setup_reader.py              |   2 +-
 src/poetry/version/version_selector.py        |   2 +-
 tests/console/commands/env/helpers.py         |   2 +-
 tests/console/commands/env/test_remove.py     |   2 +-
 tests/console/commands/env/test_use.py        |   2 +-
 tests/console/commands/self/test_update.py    |   2 +-
 tests/console/commands/test_add.py            |   2 +-
 tests/console/commands/test_publish.py        |   4 ++--
 ...2.3.tar.gz => simple_project-1.2.3.tar.gz} | Bin
 tests/helpers.py                              |   6 +++---
 .../masonry/builders/test_editable_builder.py |   2 +-
 tests/packages/test_locker.py                 |   2 +-
 tests/repositories/link_sources/test_base.py  |   2 +-
 tests/repositories/link_sources/test_html.py  |   2 +-
 tests/repositories/test_legacy_repository.py  |   2 +-
 tests/repositories/test_pool.py               |   2 +-
 tests/repositories/test_pypi_repository.py    |   2 +-
 tests/repositories/test_repository.py         |   2 +-
 tests/test_factory.py                         |   2 +-
 tests/utils/test_env.py                       |   2 +-
 43 files changed, 65 insertions(+), 69 deletions(-)
 rename tests/fixtures/simple_project/dist/{simple-project-1.2.3.tar.gz => simple_project-1.2.3.tar.gz} (100%)

diff --git a/poetry.lock b/poetry.lock
index c8db7c57f8..69ea29c1b1 100644
--- a/poetry.lock
+++ b/poetry.lock
@@ -513,22 +513,15 @@ testing = ["pytest", "pytest-benchmark"]
 
 [[package]]
 name = "poetry-core"
-version = "1.2.0"
+version = "1.3.1"
 description = "Poetry PEP 517 Build Backend"
 category = "main"
 optional = false
-python-versions = "^3.7"
-develop = false
+python-versions = ">=3.7,<4.0"
 
 [package.dependencies]
 importlib-metadata = {version = ">=1.7.0", markers = "python_version < \"3.8\""}
 
-[package.source]
-type = "git"
-url = "https://github.com/finswimmer/core.git"
-reference = "fix/available-pythons"
-resolved_reference = "5e133e5547949ec5e0c469dda9231cc850eb83bd"
-
 [[package]]
 name = "poetry-plugin-export"
 version = "1.1.1"
@@ -958,7 +951,7 @@ testing = ["func-timeout", "jaraco.itertools", "pytest (>=6)", "pytest-black (>=
 [metadata]
 lock-version = "1.1"
 python-versions = "^3.7"
-content-hash = "c7bdae481aa10cd023f9e00b8fd737bae086a828b670f6899e98968bdd587d3c"
+content-hash = "1ebadc410b20420b0b570d94dc78220ae54ad814498b1c2fa3fb3cbd183a1413"
 
 [metadata.files]
 attrs = [
@@ -1366,7 +1359,10 @@ pluggy = [
     {file = "pluggy-1.0.0-py2.py3-none-any.whl", hash = "sha256:74134bbf457f031a36d68416e1509f34bd5ccc019f0bcc952c7b909d06b37bd3"},
     {file = "pluggy-1.0.0.tar.gz", hash = "sha256:4224373bacce55f955a878bf9cfa763c1e360858e330072059e10bad68531159"},
 ]
-poetry-core = []
+poetry-core = [
+    {file = "poetry-core-1.3.1.tar.gz", hash = "sha256:f4e68f596ba7560d41f67c705e160a0ed1a061c564cc1f989a5829aa64ea6279"},
+    {file = "poetry_core-1.3.1-py3-none-any.whl", hash = "sha256:da1018d30dcbed101865a24c2a79c60be3f9800e7c91721c6ec9d4bc9e210538"},
+]
 poetry-plugin-export = [
     {file = "poetry-plugin-export-1.1.1.tar.gz", hash = "sha256:23e3e512a609b54ef5ac441339fc9e68fd41e61d15bd924eb0094b4fda1e30d0"},
     {file = "poetry_plugin_export-1.1.1-py3-none-any.whl", hash = "sha256:170fa367794d2385975d75298fe5509f772d35216ee36b8fa50c0350a064b761"},
diff --git a/pyproject.toml b/pyproject.toml
index d4e362e28e..c66038743a 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -44,7 +44,7 @@ generate-setup-file = false
 [tool.poetry.dependencies]
 python = "^3.7"
 
-poetry-core = "^1.2.0"
+poetry-core = "^1.3.1"
 poetry-plugin-export = "^1.1.1"
 "backports.cached-property" = { version = "^1.0.2", python = "<3.8" }
 cachecontrol = { version = "^0.12.9", extras = ["filecache"] }
@@ -77,8 +77,6 @@ urllib3 = "^1.26.0"
 pre-commit = "^2.6"
 
 [tool.poetry.group.test.dependencies]
-# TODO: remove when bumping poetry-core to 1.3
-poetry-core = { git = "https://github.com/finswimmer/core.git", branch = "fix/available-pythons" }
 deepdiff = "^5.0"
 flatdict = "^4.0.1"
 httpretty = "^1.0"
diff --git a/src/poetry/console/commands/add.py b/src/poetry/console/commands/add.py
index 7e231ceec8..6a0c38f9f2 100644
--- a/src/poetry/console/commands/add.py
+++ b/src/poetry/console/commands/add.py
@@ -95,7 +95,7 @@ class AddCommand(InstallerCommand, InitCommand):
     loggers = ["poetry.repositories.pypi_repository", "poetry.inspection.info"]
 
     def handle(self) -> int:
-        from poetry.core.semver.helpers import parse_constraint
+        from poetry.core.constraints.version import parse_constraint
         from tomlkit import inline_table
         from tomlkit import parse as parse_toml
         from tomlkit import table
diff --git a/src/poetry/console/commands/self/add.py b/src/poetry/console/commands/self/add.py
index 487239d43c..1da823d999 100644
--- a/src/poetry/console/commands/self/add.py
+++ b/src/poetry/console/commands/self/add.py
@@ -1,6 +1,6 @@
 from __future__ import annotations
 
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
 
 from poetry.__version__ import __version__
 from poetry.console.commands.add import AddCommand
diff --git a/src/poetry/console/commands/show.py b/src/poetry/console/commands/show.py
index 96fda7da83..7b0c55b3e2 100644
--- a/src/poetry/console/commands/show.py
+++ b/src/poetry/console/commands/show.py
@@ -533,7 +533,7 @@ def find_latest_package(
         return selector.find_best_candidate(name, f">={package.pretty_version}")
 
     def get_update_status(self, latest: Package, package: Package) -> str:
-        from poetry.core.semver.helpers import parse_constraint
+        from poetry.core.constraints.version import parse_constraint
 
         if latest.full_pretty_version == package.full_pretty_version:
             return "up-to-date"
diff --git a/src/poetry/console/commands/version.py b/src/poetry/console/commands/version.py
index fbccd8a8cc..c494879c4d 100644
--- a/src/poetry/console/commands/version.py
+++ b/src/poetry/console/commands/version.py
@@ -11,7 +11,7 @@
 
 
 if TYPE_CHECKING:
-    from poetry.core.semver.version import Version
+    from poetry.core.constraints.version import Version
 
 
 class VersionCommand(Command):
@@ -91,7 +91,7 @@ def handle(self) -> int:
         return 0
 
     def increment_version(self, version: str, rule: str) -> Version:
-        from poetry.core.semver.version import Version
+        from poetry.core.constraints.version import Version
 
         try:
             parsed = Version.parse(version)
diff --git a/src/poetry/installation/chooser.py b/src/poetry/installation/chooser.py
index 53e746fdfd..d5ee2c6d57 100644
--- a/src/poetry/installation/chooser.py
+++ b/src/poetry/installation/chooser.py
@@ -14,9 +14,9 @@
 
 
 if TYPE_CHECKING:
+    from poetry.core.constraints.version import Version
     from poetry.core.packages.package import Package
     from poetry.core.packages.utils.link import Link
-    from poetry.core.semver.version import Version
 
     from poetry.repositories.pool import Pool
     from poetry.utils.env import Env
diff --git a/src/poetry/installation/pip_installer.py b/src/poetry/installation/pip_installer.py
index dcb6229db1..7ee24915f6 100644
--- a/src/poetry/installation/pip_installer.py
+++ b/src/poetry/installation/pip_installer.py
@@ -10,8 +10,8 @@
 from typing import TYPE_CHECKING
 from typing import Any
 
+from poetry.core.constraints.version import Version
 from poetry.core.pyproject.toml import PyProjectTOML
-from poetry.core.semver.version import Version
 
 from poetry.installation.base_installer import BaseInstaller
 from poetry.repositories.http import HTTPRepository
diff --git a/src/poetry/masonry/builders/editable.py b/src/poetry/masonry/builders/editable.py
index fac1569e67..1b38c2bee0 100644
--- a/src/poetry/masonry/builders/editable.py
+++ b/src/poetry/masonry/builders/editable.py
@@ -10,10 +10,10 @@
 from pathlib import Path
 from typing import TYPE_CHECKING
 
+from poetry.core.constraints.version import Version
 from poetry.core.masonry.builders.builder import Builder
 from poetry.core.masonry.builders.sdist import SdistBuilder
 from poetry.core.masonry.utils.package_include import PackageInclude
-from poetry.core.semver.version import Version
 
 from poetry.utils._compat import WINDOWS
 from poetry.utils._compat import decode
diff --git a/src/poetry/mixology/failure.py b/src/poetry/mixology/failure.py
index 6c11350aba..f4629aa56c 100644
--- a/src/poetry/mixology/failure.py
+++ b/src/poetry/mixology/failure.py
@@ -3,7 +3,7 @@
 from typing import TYPE_CHECKING
 from typing import cast
 
-from poetry.core.semver.helpers import parse_constraint
+from poetry.core.constraints.version import parse_constraint
 
 from poetry.mixology.incompatibility_cause import ConflictCause
 from poetry.mixology.incompatibility_cause import PythonCause
diff --git a/src/poetry/mixology/solutions/solutions/python_requirement_solution.py b/src/poetry/mixology/solutions/solutions/python_requirement_solution.py
index cfade7669c..54e6c81910 100644
--- a/src/poetry/mixology/solutions/solutions/python_requirement_solution.py
+++ b/src/poetry/mixology/solutions/solutions/python_requirement_solution.py
@@ -12,7 +12,7 @@
 
 class PythonRequirementSolution(Solution):  # type: ignore[misc]
     def __init__(self, exception: SolverProblemError) -> None:
-        from poetry.core.semver.helpers import parse_constraint
+        from poetry.core.constraints.version import parse_constraint
 
         from poetry.mixology.incompatibility_cause import PythonCause
 
diff --git a/src/poetry/mixology/term.py b/src/poetry/mixology/term.py
index d5c4577cea..980eda6fc5 100644
--- a/src/poetry/mixology/term.py
+++ b/src/poetry/mixology/term.py
@@ -8,8 +8,8 @@
 
 
 if TYPE_CHECKING:
+    from poetry.core.constraints.version import VersionConstraint
     from poetry.core.packages.dependency import Dependency
-    from poetry.core.semver.version_constraint import VersionConstraint
 
 
 class Term:
diff --git a/src/poetry/packages/locker.py b/src/poetry/packages/locker.py
index 681547f4f1..7fa5fd9295 100644
--- a/src/poetry/packages/locker.py
+++ b/src/poetry/packages/locker.py
@@ -12,10 +12,10 @@
 from typing import cast
 
 from packaging.utils import canonicalize_name
+from poetry.core.constraints.version import Version
+from poetry.core.constraints.version import parse_constraint
 from poetry.core.packages.dependency import Dependency
 from poetry.core.packages.package import Package
-from poetry.core.semver.helpers import parse_constraint
-from poetry.core.semver.version import Version
 from poetry.core.toml.file import TOMLFile
 from poetry.core.version.markers import parse_marker
 from poetry.core.version.requirements import InvalidRequirement
diff --git a/src/poetry/publishing/uploader.py b/src/poetry/publishing/uploader.py
index 65163e1bd9..4f57b370b8 100644
--- a/src/poetry/publishing/uploader.py
+++ b/src/poetry/publishing/uploader.py
@@ -10,7 +10,7 @@
 import requests
 
 from poetry.core.masonry.metadata import Metadata
-from poetry.core.masonry.utils.helpers import escape_name
+from poetry.core.masonry.utils.helpers import distribution_name
 from requests import adapters
 from requests.exceptions import ConnectionError
 from requests.exceptions import HTTPError
@@ -79,9 +79,11 @@ def files(self) -> list[Path]:
         version = self._package.version.to_string()
 
         wheels = list(
-            dist.glob(f"{escape_name(self._package.pretty_name)}-{version}-*.whl")
+            dist.glob(f"{distribution_name(self._package.name)}-{version}-*.whl")
+        )
+        tars = list(
+            dist.glob(f"{distribution_name(self._package.name)}-{version}.tar.gz")
         )
-        tars = list(dist.glob(f"{self._package.pretty_name}-{version}.tar.gz"))
 
         return sorted(wheels + tars)
 
diff --git a/src/poetry/puzzle/provider.py b/src/poetry/puzzle/provider.py
index 104a6211d2..baf04dc60e 100644
--- a/src/poetry/puzzle/provider.py
+++ b/src/poetry/puzzle/provider.py
@@ -16,9 +16,9 @@
 from typing import cast
 
 from cleo.ui.progress_indicator import ProgressIndicator
+from poetry.core.constraints.version import EmptyConstraint
+from poetry.core.constraints.version import Version
 from poetry.core.packages.utils.utils import get_python_constraint_from_marker
-from poetry.core.semver.empty_constraint import EmptyConstraint
-from poetry.core.semver.version import Version
 from poetry.core.version.markers import AnyMarker
 from poetry.core.version.markers import MarkerUnion
 
@@ -43,13 +43,13 @@
 
     from cleo.io.io import IO
     from packaging.utils import NormalizedName
+    from poetry.core.constraints.version import VersionConstraint
     from poetry.core.packages.dependency import Dependency
     from poetry.core.packages.directory_dependency import DirectoryDependency
     from poetry.core.packages.file_dependency import FileDependency
     from poetry.core.packages.package import Package
     from poetry.core.packages.url_dependency import URLDependency
     from poetry.core.packages.vcs_dependency import VCSDependency
-    from poetry.core.semver.version_constraint import VersionConstraint
     from poetry.core.version.markers import BaseMarker
 
     from poetry.repositories import Pool
diff --git a/src/poetry/repositories/cached.py b/src/poetry/repositories/cached.py
index 8c5b74a608..d3c6064d00 100644
--- a/src/poetry/repositories/cached.py
+++ b/src/poetry/repositories/cached.py
@@ -7,7 +7,7 @@
 
 from cachy import CacheManager
 from packaging.utils import canonicalize_name
-from poetry.core.semver.helpers import parse_constraint
+from poetry.core.constraints.version import parse_constraint
 
 from poetry.config.config import Config
 from poetry.repositories.repository import Repository
@@ -15,8 +15,8 @@
 
 if TYPE_CHECKING:
     from packaging.utils import NormalizedName
+    from poetry.core.constraints.version import Version
     from poetry.core.packages.package import Package
-    from poetry.core.semver.version import Version
 
     from poetry.inspection.info import PackageInfo
 
diff --git a/src/poetry/repositories/http.py b/src/poetry/repositories/http.py
index 0df9f13901..16bac1e4c1 100644
--- a/src/poetry/repositories/http.py
+++ b/src/poetry/repositories/http.py
@@ -13,9 +13,9 @@
 
 import requests
 
+from poetry.core.constraints.version import parse_constraint
 from poetry.core.packages.dependency import Dependency
 from poetry.core.packages.utils.link import Link
-from poetry.core.semver.helpers import parse_constraint
 from poetry.core.utils.helpers import temporary_directory
 from poetry.core.version.markers import parse_marker
 
diff --git a/src/poetry/repositories/legacy_repository.py b/src/poetry/repositories/legacy_repository.py
index c4019b6f17..bc20b98d9a 100644
--- a/src/poetry/repositories/legacy_repository.py
+++ b/src/poetry/repositories/legacy_repository.py
@@ -13,9 +13,9 @@
 
 if TYPE_CHECKING:
     from packaging.utils import NormalizedName
+    from poetry.core.constraints.version import Version
+    from poetry.core.constraints.version import VersionConstraint
     from poetry.core.packages.utils.link import Link
-    from poetry.core.semver.version import Version
-    from poetry.core.semver.version_constraint import VersionConstraint
 
     from poetry.config.config import Config
 
diff --git a/src/poetry/repositories/link_sources/base.py b/src/poetry/repositories/link_sources/base.py
index 9ffa3e2e7e..5f9a26c304 100644
--- a/src/poetry/repositories/link_sources/base.py
+++ b/src/poetry/repositories/link_sources/base.py
@@ -7,8 +7,8 @@
 from typing import DefaultDict
 from typing import List
 
+from poetry.core.constraints.version import Version
 from poetry.core.packages.package import Package
-from poetry.core.semver.version import Version
 
 from poetry.utils._compat import cached_property
 from poetry.utils.patterns import sdist_file_re
diff --git a/src/poetry/repositories/pool.py b/src/poetry/repositories/pool.py
index edc53e71ba..43f1e9d2a0 100644
--- a/src/poetry/repositories/pool.py
+++ b/src/poetry/repositories/pool.py
@@ -7,9 +7,9 @@
 
 
 if TYPE_CHECKING:
+    from poetry.core.constraints.version import Version
     from poetry.core.packages.dependency import Dependency
     from poetry.core.packages.package import Package
-    from poetry.core.semver.version import Version
 
 
 class Pool(Repository):
diff --git a/src/poetry/repositories/pypi_repository.py b/src/poetry/repositories/pypi_repository.py
index ac70b14a36..491f6e0317 100644
--- a/src/poetry/repositories/pypi_repository.py
+++ b/src/poetry/repositories/pypi_repository.py
@@ -27,8 +27,8 @@
 
 if TYPE_CHECKING:
     from packaging.utils import NormalizedName
-    from poetry.core.semver.version import Version
-    from poetry.core.semver.version_constraint import VersionConstraint
+    from poetry.core.constraints.version import Version
+    from poetry.core.constraints.version import VersionConstraint
 
 SUPPORTED_PACKAGE_TYPES = {"sdist", "bdist_wheel"}
 
diff --git a/src/poetry/repositories/repository.py b/src/poetry/repositories/repository.py
index dbaea561bf..ee54362af5 100644
--- a/src/poetry/repositories/repository.py
+++ b/src/poetry/repositories/repository.py
@@ -5,18 +5,18 @@
 from typing import TYPE_CHECKING
 
 from packaging.utils import canonicalize_name
-from poetry.core.semver.version import Version
-from poetry.core.semver.version_range import VersionRange
+from poetry.core.constraints.version import Version
+from poetry.core.constraints.version import VersionRange
 
 from poetry.repositories.exceptions import PackageNotFound
 
 
 if TYPE_CHECKING:
     from packaging.utils import NormalizedName
+    from poetry.core.constraints.version import VersionConstraint
     from poetry.core.packages.dependency import Dependency
     from poetry.core.packages.package import Package
     from poetry.core.packages.utils.link import Link
-    from poetry.core.semver.version_constraint import VersionConstraint
 
 
 class Repository:
diff --git a/src/poetry/utils/env.py b/src/poetry/utils/env.py
index 562c7751b1..d76972ca50 100644
--- a/src/poetry/utils/env.py
+++ b/src/poetry/utils/env.py
@@ -30,8 +30,8 @@
 from packaging.tags import interpreter_name
 from packaging.tags import interpreter_version
 from packaging.tags import sys_tags
-from poetry.core.semver.helpers import parse_constraint
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
+from poetry.core.constraints.version import parse_constraint
 from poetry.core.toml.file import TOMLFile
 from poetry.core.utils.helpers import temporary_directory
 from virtualenv.seed.wheels.embed import get_embed_wheel
diff --git a/src/poetry/utils/setup_reader.py b/src/poetry/utils/setup_reader.py
index 8676b1eeea..f0ecdde822 100644
--- a/src/poetry/utils/setup_reader.py
+++ b/src/poetry/utils/setup_reader.py
@@ -6,7 +6,7 @@
 from pathlib import Path
 from typing import Any
 
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
 
 
 class SetupReader:
diff --git a/src/poetry/version/version_selector.py b/src/poetry/version/version_selector.py
index adac9fcbf9..476e363544 100644
--- a/src/poetry/version/version_selector.py
+++ b/src/poetry/version/version_selector.py
@@ -2,7 +2,7 @@
 
 from typing import TYPE_CHECKING
 
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
 
 
 if TYPE_CHECKING:
diff --git a/tests/console/commands/env/helpers.py b/tests/console/commands/env/helpers.py
index c9dc0a7a41..0bf9412815 100644
--- a/tests/console/commands/env/helpers.py
+++ b/tests/console/commands/env/helpers.py
@@ -4,7 +4,7 @@
 from typing import TYPE_CHECKING
 from typing import Any
 
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
 
 
 if TYPE_CHECKING:
diff --git a/tests/console/commands/env/test_remove.py b/tests/console/commands/env/test_remove.py
index 0511e4ec25..428d4f13df 100644
--- a/tests/console/commands/env/test_remove.py
+++ b/tests/console/commands/env/test_remove.py
@@ -4,7 +4,7 @@
 
 import pytest
 
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
 
 from tests.console.commands.env.helpers import check_output_wrapper
 
diff --git a/tests/console/commands/env/test_use.py b/tests/console/commands/env/test_use.py
index 3f4095a18f..ad05e1e73b 100644
--- a/tests/console/commands/env/test_use.py
+++ b/tests/console/commands/env/test_use.py
@@ -8,7 +8,7 @@
 import pytest
 import tomlkit
 
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
 from poetry.core.toml.file import TOMLFile
 
 from poetry.utils.env import MockEnv
diff --git a/tests/console/commands/self/test_update.py b/tests/console/commands/self/test_update.py
index 1c20920d0b..9cc7e523d2 100644
--- a/tests/console/commands/self/test_update.py
+++ b/tests/console/commands/self/test_update.py
@@ -5,8 +5,8 @@
 
 import pytest
 
+from poetry.core.constraints.version import Version
 from poetry.core.packages.package import Package
-from poetry.core.semver.version import Version
 
 from poetry.__version__ import __version__
 from poetry.factory import Factory
diff --git a/tests/console/commands/test_add.py b/tests/console/commands/test_add.py
index 72dc883682..fedaacc020 100644
--- a/tests/console/commands/test_add.py
+++ b/tests/console/commands/test_add.py
@@ -7,7 +7,7 @@
 
 import pytest
 
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
 
 from poetry.repositories.legacy_repository import LegacyRepository
 from tests.helpers import get_dependency
diff --git a/tests/console/commands/test_publish.py b/tests/console/commands/test_publish.py
index 559f58f323..f4241a1a87 100644
--- a/tests/console/commands/test_publish.py
+++ b/tests/console/commands/test_publish.py
@@ -107,7 +107,7 @@ def test_publish_dry_run_skip_existing(
     error = app_tester.io.fetch_error()
 
     assert "Publishing simple-project (1.2.3) to PyPI" in output
-    assert "- Uploading simple-project-1.2.3.tar.gz" in error
+    assert "- Uploading simple_project-1.2.3.tar.gz" in error
     assert "- Uploading simple_project-1.2.3-py2.py3-none-any.whl" in error
 
 
@@ -125,4 +125,4 @@ def test_skip_existing_output(
     assert exit_code == 0
 
     error = app_tester.io.fetch_error()
-    assert "- Uploading simple-project-1.2.3.tar.gz File exists. Skipping" in error
+    assert "- Uploading simple_project-1.2.3.tar.gz File exists. Skipping" in error
diff --git a/tests/fixtures/simple_project/dist/simple-project-1.2.3.tar.gz b/tests/fixtures/simple_project/dist/simple_project-1.2.3.tar.gz
similarity index 100%
rename from tests/fixtures/simple_project/dist/simple-project-1.2.3.tar.gz
rename to tests/fixtures/simple_project/dist/simple_project-1.2.3.tar.gz
diff --git a/tests/helpers.py b/tests/helpers.py
index 198fa1bc20..ca3a93b9ce 100644
--- a/tests/helpers.py
+++ b/tests/helpers.py
@@ -11,7 +11,7 @@
 from typing import TYPE_CHECKING
 from typing import Any
 
-from poetry.core.masonry.utils.helpers import escape_name
+from poetry.core.masonry.utils.helpers import distribution_name
 from poetry.core.packages.package import Package
 from poetry.core.packages.utils.link import Link
 from poetry.core.toml.file import TOMLFile
@@ -30,8 +30,8 @@
 if TYPE_CHECKING:
     from collections.abc import Iterator
 
+    from poetry.core.constraints.version import Version
     from poetry.core.packages.dependency import Dependency
-    from poetry.core.semver.version import Version
     from pytest_mock import MockerFixture
     from tomlkit.toml_document import TOMLDocument
 
@@ -235,7 +235,7 @@ def find_packages(self, dependency: Dependency) -> list[Package]:
     def find_links_for_package(self, package: Package) -> list[Link]:
         return [
             Link(
-                f"https://foo.bar/files/{escape_name(package.name)}"
+                f"https://foo.bar/files/{distribution_name(package.name)}"
                 f"-{package.version.to_string()}-py2.py3-none-any.whl"
             )
         ]
diff --git a/tests/masonry/builders/test_editable_builder.py b/tests/masonry/builders/test_editable_builder.py
index d8733154ce..effefb4c81 100644
--- a/tests/masonry/builders/test_editable_builder.py
+++ b/tests/masonry/builders/test_editable_builder.py
@@ -12,7 +12,7 @@
 
 from cleo.io.null_io import NullIO
 from deepdiff import DeepDiff
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
 
 from poetry.factory import Factory
 from poetry.masonry.builders.editable import EditableBuilder
diff --git a/tests/packages/test_locker.py b/tests/packages/test_locker.py
index b0be7e1a52..7fb2772e6b 100644
--- a/tests/packages/test_locker.py
+++ b/tests/packages/test_locker.py
@@ -14,9 +14,9 @@
 import pytest
 import tomlkit
 
+from poetry.core.constraints.version import Version
 from poetry.core.packages.package import Package
 from poetry.core.packages.project_package import ProjectPackage
-from poetry.core.semver.version import Version
 
 from poetry.factory import Factory
 from poetry.packages.locker import GENERATED_COMMENT
diff --git a/tests/repositories/link_sources/test_base.py b/tests/repositories/link_sources/test_base.py
index ef400a716d..5066473471 100644
--- a/tests/repositories/link_sources/test_base.py
+++ b/tests/repositories/link_sources/test_base.py
@@ -7,9 +7,9 @@
 import pytest
 
 from packaging.utils import canonicalize_name
+from poetry.core.constraints.version import Version
 from poetry.core.packages.package import Package
 from poetry.core.packages.utils.link import Link
-from poetry.core.semver.version import Version
 
 from poetry.repositories.link_sources.base import LinkSource
 
diff --git a/tests/repositories/link_sources/test_html.py b/tests/repositories/link_sources/test_html.py
index 780262d9ad..4cc5d05758 100644
--- a/tests/repositories/link_sources/test_html.py
+++ b/tests/repositories/link_sources/test_html.py
@@ -3,8 +3,8 @@
 import pytest
 
 from packaging.utils import canonicalize_name
+from poetry.core.constraints.version import Version
 from poetry.core.packages.utils.link import Link
-from poetry.core.semver.version import Version
 
 from poetry.repositories.link_sources.html import HTMLPage
 
diff --git a/tests/repositories/test_legacy_repository.py b/tests/repositories/test_legacy_repository.py
index 042e8064a5..fb96c65b1c 100644
--- a/tests/repositories/test_legacy_repository.py
+++ b/tests/repositories/test_legacy_repository.py
@@ -11,8 +11,8 @@
 import requests
 
 from packaging.utils import canonicalize_name
+from poetry.core.constraints.version import Version
 from poetry.core.packages.dependency import Dependency
-from poetry.core.semver.version import Version
 
 from poetry.factory import Factory
 from poetry.repositories.exceptions import PackageNotFound
diff --git a/tests/repositories/test_pool.py b/tests/repositories/test_pool.py
index 74aa675054..84f18c4ea5 100644
--- a/tests/repositories/test_pool.py
+++ b/tests/repositories/test_pool.py
@@ -2,7 +2,7 @@
 
 import pytest
 
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
 
 from poetry.repositories import Pool
 from poetry.repositories import Repository
diff --git a/tests/repositories/test_pypi_repository.py b/tests/repositories/test_pypi_repository.py
index 032dcccca7..7396324af5 100644
--- a/tests/repositories/test_pypi_repository.py
+++ b/tests/repositories/test_pypi_repository.py
@@ -10,8 +10,8 @@
 
 import pytest
 
+from poetry.core.constraints.version import Version
 from poetry.core.packages.dependency import Dependency
-from poetry.core.semver.version import Version
 from requests.exceptions import TooManyRedirects
 from requests.models import Response
 
diff --git a/tests/repositories/test_repository.py b/tests/repositories/test_repository.py
index aad77894ca..d2ff270b10 100644
--- a/tests/repositories/test_repository.py
+++ b/tests/repositories/test_repository.py
@@ -2,8 +2,8 @@
 
 import pytest
 
+from poetry.core.constraints.version import Version
 from poetry.core.packages.package import Package
-from poetry.core.semver.version import Version
 
 from poetry.factory import Factory
 from poetry.repositories import Repository
diff --git a/tests/test_factory.py b/tests/test_factory.py
index e264d51f73..5671fdc5ed 100644
--- a/tests/test_factory.py
+++ b/tests/test_factory.py
@@ -7,7 +7,7 @@
 
 from deepdiff import DeepDiff
 from packaging.utils import canonicalize_name
-from poetry.core.semver.helpers import parse_constraint
+from poetry.core.constraints.version import parse_constraint
 from poetry.core.toml.file import TOMLFile
 
 from poetry.factory import Factory
diff --git a/tests/utils/test_env.py b/tests/utils/test_env.py
index 974ac0a688..52f1352dd5 100644
--- a/tests/utils/test_env.py
+++ b/tests/utils/test_env.py
@@ -12,7 +12,7 @@
 import tomlkit
 
 from cleo.io.null_io import NullIO
-from poetry.core.semver.version import Version
+from poetry.core.constraints.version import Version
 from poetry.core.toml.file import TOMLFile
 
 from poetry.factory import Factory
